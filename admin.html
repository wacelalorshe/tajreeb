<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة الإدارة - Aseel TV</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* الأنماط السابقة تبقى كما هي */
        body {
            background: linear-gradient(to right, #322769, #151825, #322769);
            color: white;
            min-height: 100vh;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .admin-panel {
            background: rgba(0, 0, 0, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #42318F;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        
        .login-required {
            text-align: center;
            padding: 60px 30px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            margin: 50px 0;
            border: 2px solid #42318F;
        }
        
        /* باقي الأنماط تبقى كما هي */
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="row">
            <div class="col-12">
                <!-- Header -->
                <div class="text-center mb-5">
                    <h1 style="color: #E1E1E1; text-shadow: 0 2px 4px rgba(0,0,0,0.5); font-size: 2.5rem;">
                        <i class="uil uil-setting"></i> لوحة إدارة القنوات والأقسام
                    </h1>
                    <p class="text-muted">إدارة قنوات BEIN SPORT والأقسام</p>
                </div>
                
                <!-- Admin Panel (shown when authenticated) -->
                <div id="adminPanel" class="admin-panel" style="display: none;">
                    <!-- Firebase Connection Status -->
                    <div id="firebaseConnection" class="alert alert-warning" style="display: none;">
                        <i class="uil uil-exclamation-triangle"></i>
                        <strong>تنبيه:</strong> لا يمكن الاتصال بقاعدة البيانات. تأكد من اتصال الإنترنت وقواعد Firestore.
                    </div>

                    <!-- Stats Overview -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="stats-card">
                                <div class="stats-number" id="totalSections">0</div>
                                <div class="stats-label">عدد الأقسام</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stats-card">
                                <div class="stats-number" id="totalChannels">0</div>
                                <div class="stats-label">عدد القنوات</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stats-card">
                                <div class="stats-number" id="activeSections">0</div>
                                <div class="stats-label">الأقسام النشطة</div>
                            </div>
                        </div>
                    </div>

                    <!-- باقي المحتوى يبقى كما هو -->
                    <!-- Navigation Tabs -->
                    <ul class="nav nav-tabs nav-tabs-custom mb-4" id="adminTabs">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#sectionsTab">
                                <i class="uil uil-folder"></i> إدارة الأقسام
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#channelsTab">
                                <i class="uil uil-tv"></i> إدارة القنوات
                            </a>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content">
                        <!-- Sections Management Tab -->
                        <div class="tab-pane fade show active" id="sectionsTab">
                            <!-- Add Section Form -->
                            <div class="card mb-5" style="background: rgba(0,0,0,0.7); border: 1px solid #42318F;">
                                <div class="card-header card-header-custom">
                                    <h4 class="mb-0 text-white">
                                        <i class="uil uil-plus-circle"></i> إضافة قسم جديد
                                    </h4>
                                </div>
                                <div class="card-body">
                                    <form id="sectionForm">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label class="form-label">اسم القسم *</label>
                                                    <input type="text" id="sectionName" class="form-control" required placeholder="أدخل اسم القسم">
                                                </div>
                                                <div class="form-group mb-3">
                                                    <label class="form-label">ترتيب العرض *</label>
                                                    <input type="number" id="sectionOrder" class="form-control" value="1" min="1" required>
                                                    <small class="form-text text-muted">رقم أقل يعني ظهوراً أبكر</small>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label class="form-label">حالة القسم</label>
                                                    <select id="sectionStatus" class="form-control">
                                                        <option value="active">نشط</option>
                                                        <option value="inactive">غير نشط</option>
                                                    </select>
                                                </div>
                                                <div class="form-group mb-3">
                                                    <label class="form-label">وصف القسم (اختياري)</label>
                                                    <textarea id="sectionDescription" class="form-control" rows="3" placeholder="أدخل وصفاً للقسم"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success w-100 py-3 btn-custom" style="font-size: 16px;">
                                            <i class="uil uil-plus-circle"></i> إضافة قسم جديد
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- Sections List -->
                            <div class="card" style="background: rgba(0,0,0,0.7); border: 1px solid #42318F;">
                                <div class="card-header card-header-custom">
                                    <h4 class="mb-0 text-white">
                                        <i class="uil uil-folder"></i> الأقسام المضافة
                                        <span id="sectionsCount" class="badge bg-primary ms-2">0</span>
                                    </h4>
                                </div>
                                <div class="card-body">
                                    <div id="sectionsList">
                                        <!-- Sections will be loaded here -->
                                        <div class="text-center py-5">
                                            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                                                <span class="visually-hidden">جاري التحميل...</span>
                                            </div>
                                            <p class="mt-3 text-muted">جاري تحميل الأقسام...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Channels Management Tab -->
                        <div class="tab-pane fade" id="channelsTab">
                            <!-- Add Channel Form -->
                            <div class="card mb-5" style="background: rgba(0,0,0,0.7); border: 1px solid #42318F;">
                                <div class="card-header card-header-custom">
                                    <h4 class="mb-0 text-white">
                                        <i class="uil uil-plus-circle"></i> إضافة قناة جديدة
                                    </h4>
                                </div>
                                <div class="card-body">
                                    <form id="channelForm">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label class="form-label">اسم القناة *</label>
                                                    <input type="text" id="channelName" class="form-control" required placeholder="أدخل اسم القناة">
                                                </div>
                                                <div class="form-group mb-3">
                                                    <label class="form-label">القسم *</label>
                                                    <select id="channelSection" class="form-control" required>
                                                        <option value="">اختر القسم</option>
                                                        <!-- Sections will be loaded here -->
                                                    </select>
                                                </div>
                                                <div class="form-group mb-3">
                                                    <label class="form-label">رابط الصورة</label>
                                                    <input type="text" id="channelImage" class="form-control" placeholder="https://example.com/image.jpg">
                                                    <small class="form-text text-muted">اتركه فارغاً لاستخدام صورة افتراضية</small>
                                                </div>
                                                <div class="form-group mb-3">
                                                    <label class="form-label">رابط البث (Base64) *</label>
                                                    <textarea id="channelUrl" class="form-control" rows="4" required placeholder="أدخل رابط البث المشفر base64"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group mb-3">
                                                    <label class="form-label">رابط التطبيق</label>
                                                    <input type="text" id="channelApp" class="form-control" 
                                                           value="https://play.google.com/store/apps/details?id=com.xpola.player">
                                                </div>
                                                <div class="form-group mb-3">
                                                    <label class="form-label">رابط التحميل</label>
                                                    <input type="text" id="channelDownload" class="form-control" 
                                                           value="https://play.google.com/store/apps/details?id=com.xpola.player">
                                                </div>
                                                <div class="form-group mb-3">
                                                    <label class="form-label">ترتيب العرض</label>
                                                    <input type="number" id="channelOrder" class="form-control" value="1" min="1">
                                                    <small class="form-text text-muted">رقم أقل يعني ظهوراً أبكر</small>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-success w-100 py-3 btn-custom" style="font-size: 16px;">
                                            <i class="uil uil-plus-circle"></i> إضافة قناة جديدة
                                        </button>
                                    </form>
                                </div>
                            </div>
                            
                            <!-- Channels List -->
                            <div class="card" style="background: rgba(0,0,0,0.7); border: 1px solid #42318F;">
                                <div class="card-header card-header-custom">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h4 class="mb-0 text-white">
                                            <i class="uil uil-list-ui-alt"></i> القنوات المضافة
                                            <span id="channelsCount" class="badge bg-primary ms-2">0</span>
                                        </h4>
                                        <div>
                                            <select id="filterSection" class="form-select" style="width: auto; background: rgba(255,255,255,0.1); color: white; border: 1px solid #42318F;">
                                                <option value="">جميع الأقسام</option>
                                                <!-- Sections will be loaded here -->
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div id="channelsList">
                                        <!-- Channels will be loaded here -->
                                        <div class="text-center py-5">
                                            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                                                <span class="visually-hidden">جاري التحميل...</span>
                                            </div>
                                            <p class="mt-3 text-muted">جاري تحميل القنوات...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="mt-5 text-center">
                        <a href="index.html" class="btn btn-primary me-3 btn-custom">
                            <i class="uil uil-home"></i> العودة للرئيسية
                        </a>
                        <button id="logoutAdmin" class="btn btn-danger btn-custom">
                            <i class="uil uil-signout"></i> تسجيل الخروج
                        </button>
                    </div>
                </div>

                <!-- Login Required Message (shown when not authenticated) -->
                <div id="loginRequired" class="login-required" style="display: none;">
                    <div class="mb-4">
                        <i class="uil uil-lock-alt" style="font-size: 80px; color: #FF5200;"></i>
                    </div>
                    <h3 class="text-white mb-3">يجب تسجيل الدخول أولاً</h3>
                    <p class="text-white mb-4" style="font-size: 18px;">يرجى تسجيل الدخول من الصفحة الرئيسية للوصول إلى لوحة الإدارة</p>
                    <a href="index.html" class="btn btn-primary btn-lg btn-custom">
                        <i class="uil uil-signin"></i> العودة للرئيسية لتسجيل الدخول
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script src="js/firebase-config.js"></script>
    
    <script>
        // ==============================================
        // نظام المصادقة المحسّن مع معالجة أخطاء Firestore
        // ==============================================
        
        class AdminAuthManager {
            constructor() {
                this.isAuthenticated = false;
                this.currentUser = null;
                this.firebaseAvailable = false;
                this.init();
            }

            async init() {
                console.log('AdminAuthManager initializing...');
                
                // التحقق من توفر Firebase أولاً
                this.checkFirebaseAvailability();
                
                // التحقق من المصادقة باستخدام localStorage
                this.checkAuthFromStorage();
                
                // ثم إعداد مستمع Firebase إذا كان متاحاً
                this.setupAuthListener();
            }

            checkFirebaseAvailability() {
                this.firebaseAvailable = typeof firebase !== 'undefined' && 
                                       typeof db !== 'undefined' && 
                                       typeof auth !== 'undefined';
                
                console.log('Firebase available:', this.firebaseAvailable);
                
                if (!this.firebaseAvailable) {
                    this.showFirebaseWarning();
                }
            }

            checkAuthFromStorage() {
                const storedAuth = localStorage.getItem('adminAuth');
                const storedEmail = localStorage.getItem('adminEmail');
                
                console.log('Checking auth from storage:', { storedAuth, storedEmail });
                
                if (storedAuth === 'true' && storedEmail) {
                    this.isAuthenticated = true;
                    this.currentUser = { email: storedEmail };
                    console.log('User authenticated from storage:', storedEmail);
                    this.showAdminPanel();
                    return true;
                }
                
                console.log('No valid authentication found in storage');
                return false;
            }

            setupAuthListener() {
                if (!this.firebaseAvailable) {
                    console.log('Firebase not available, skipping auth listener');
                    return;
                }

                try {
                    auth.onAuthStateChanged((user) => {
                        console.log('Firebase Auth state changed:', user ? 'User signed in' : 'User signed out');
                        if (user) {
                            this.isAuthenticated = true;
                            this.currentUser = user;
                            localStorage.setItem('adminAuth', 'true');
                            localStorage.setItem('adminEmail', user.email);
                            console.log('User authenticated via Firebase:', user.email);
                            this.showAdminPanel();
                        } else {
                            // إذا لم يكن هناك مستخدم في Firebase، نعتمد على التخزين المحلي
                            if (!this.isAuthenticated) {
                                this.showLoginRequired();
                            }
                        }
                    }, (error) => {
                        console.error('Firebase Auth state change error:', error);
                        // في حالة خطأ Firebase، نعتمد على التخزين المحلي
                        if (!this.isAuthenticated) {
                            this.showLoginRequired();
                        }
                    });
                } catch (error) {
                    console.error('Error setting up auth listener:', error);
                }
            }

            showFirebaseWarning() {
                const connectionAlert = document.getElementById('firebaseConnection');
                if (connectionAlert) {
                    connectionAlert.style.display = 'block';
                }
            }

            showAdminPanel() {
                console.log('Showing admin panel');
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('loginRequired').style.display = 'none';
            }

            showLoginRequired() {
                console.log('Showing login required');
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('loginRequired').style.display = 'block';
            }

            async logout() {
                try {
                    if (this.firebaseAvailable) {
                        await auth.signOut();
                    }
                    
                    this.isAuthenticated = false;
                    this.currentUser = null;
                    localStorage.removeItem('adminAuth');
                    localStorage.removeItem('adminEmail');
                    
                    console.log('Logout successful');
                    return { success: true };
                    
                } catch (error) {
                    console.error('Logout error:', error);
                    this.isAuthenticated = false;
                    this.currentUser = null;
                    localStorage.removeItem('adminAuth');
                    localStorage.removeItem('adminEmail');
                    
                    return { success: true };
                }
            }
        }

        // ==============================================
        // نظام إدارة البيانات مع معالجة أخطاء Firestore
        // ==============================================
        
        class DataManager {
            constructor() {
                this.sections = [];
                this.channels = [];
                this.firebaseAvailable = false;
                this.checkFirebase();
            }

            checkFirebase() {
                this.firebaseAvailable = typeof firebase !== 'undefined' && typeof db !== 'undefined';
                console.log('Firebase available for data:', this.firebaseAvailable);
            }

            // دالة مساعدة للتحقق من اتصال Firestore
            async testFirestoreConnection() {
                if (!this.firebaseAvailable) {
                    return { success: false, error: 'Firebase غير متاح' };
                }

                try {
                    const testQuery = db.collection('test_connection').doc('test');
                    await testQuery.set({ test: true, timestamp: new Date() });
                    await testQuery.delete();
                    return { success: true };
                } catch (error) {
                    return { success: false, error: error.message };
                }
            }

            // تحميل الأقسام
            async loadSections() {
                if (!this.firebaseAvailable) {
                    console.log('Firebase not available, using empty sections');
                    return [];
                }

                try {
                    const snapshot = await db.collection('sections').orderBy('order').get();
                    
                    if (snapshot.empty) {
                        console.log('No sections found in database');
                        return [];
                    }

                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error('Error loading sections:', error);
                    this.handleFirestoreError(error);
                    return [];
                }
            }

            // تحميل القنوات
            async loadChannels(sectionId = null) {
                if (!this.firebaseAvailable) {
                    console.log('Firebase not available, using empty channels');
                    return [];
                }

                try {
                    let query = db.collection('channels').orderBy('order');
                    
                    if (sectionId) {
                        query = query.where('sectionId', '==', sectionId);
                    }
                    
                    const snapshot = await query.get();
                    
                    if (snapshot.empty) {
                        console.log('No channels found in database');
                        return [];
                    }

                    return snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                } catch (error) {
                    console.error('Error loading channels:', error);
                    this.handleFirestoreError(error);
                    return [];
                }
            }

            // إضافة قسم جديد
            async addSection(sectionData) {
                if (!this.firebaseAvailable) {
                    throw new Error('لا يمكن الاتصال بقاعدة البيانات');
                }

                try {
                    const docRef = await db.collection('sections').add({
                        name: sectionData.name.trim(),
                        order: parseInt(sectionData.order) || 1,
                        isActive: sectionData.isActive === 'active',
                        description: sectionData.description ? sectionData.description.trim() : '',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    });
                    
                    console.log('Section added with ID:', docRef.id);
                    return { success: true, id: docRef.id };
                    
                } catch (error) {
                    console.error('Error adding section:', error);
                    this.handleFirestoreError(error);
                    throw error;
                }
            }

            // إضافة قناة جديدة
            async addChannel(channelData) {
                if (!this.firebaseAvailable) {
                    throw new Error('لا يمكن الاتصال بقاعدة البيانات');
                }

                try {
                    const imageUrl = channelData.image && channelData.image.trim() !== '' ? 
                           channelData.image.trim() : 
                           'https://via.placeholder.com/200x100/2F2562/FFFFFF?text=' + encodeURIComponent(channelData.name);
                    
                    const docRef = await db.collection('channels').add({
                        name: channelData.name.trim(),
                        image: imageUrl,
                        url: channelData.url.trim(),
                        appUrl: channelData.appUrl.trim(),
                        downloadUrl: channelData.downloadUrl.trim(),
                        order: parseInt(channelData.order) || 1,
                        sectionId: channelData.sectionId,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    });
                    
                    console.log('Channel added with ID:', docRef.id);
                    return { success: true, id: docRef.id };
                    
                } catch (error) {
                    console.error('Error adding channel:', error);
                    this.handleFirestoreError(error);
                    throw error;
                }
            }

            // حذف قسم
            async deleteSection(sectionId) {
                if (!this.firebaseAvailable) {
                    throw new Error('لا يمكن الاتصال بقاعدة البيانات');
                }

                try {
                    await db.collection('sections').doc(sectionId).delete();
                    
                    // حذف القنوات المرتبطة
                    const channelsSnapshot = await db.collection('channels')
                        .where('sectionId', '==', sectionId)
                        .get();
                    
                    const deletePromises = channelsSnapshot.docs.map(doc => doc.ref.delete());
                    await Promise.all(deletePromises);
                    
                    return { success: true };
                    
                } catch (error) {
                    console.error('Error deleting section:', error);
                    this.handleFirestoreError(error);
                    throw error;
                }
            }

            // حذف قناة
            async deleteChannel(channelId) {
                if (!this.firebaseAvailable) {
                    throw new Error('لا يمكن الاتصال بقاعدة البيانات');
                }

                try {
                    await db.collection('channels').doc(channelId).delete();
                    return { success: true };
                    
                } catch (error) {
                    console.error('Error deleting channel:', error);
                    this.handleFirestoreError(error);
                    throw error;
                }
            }

            // معالجة أخطاء Firestore
            handleFirestoreError(error) {
                let errorMessage = 'حدث خطأ في الاتصال بقاعدة البيانات';
                
                if (error.code === 'permission-denied') {
                    errorMessage = 'ليس لديك صلاحية للوصول إلى قاعدة البيانات. تحقق من قواعد Firestore.';
                } else if (error.code === 'unavailable') {
                    errorMessage = 'لا يمكن الاتصال بقاعدة البيانات. تحقق من اتصال الإنترنت.';
                } else if (error.code === 'not-found') {
                    errorMessage = 'المجموعة غير موجودة في قاعدة البيانات.';
                } else {
                    errorMessage += ': ' + error.message;
                }
                
                this.showError(errorMessage);
                return errorMessage;
            }

            showError(message) {
                // إنشاء عنصر التنبيه
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-danger alert-dismissible fade show mt-3';
                alertDiv.innerHTML = `
                    <i class="uil uil-exclamation-triangle"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                // إضافة التنبيه في الأعلى
                const adminPanel = document.getElementById('adminPanel');
                if (adminPanel) {
                    adminPanel.insertBefore(alertDiv, adminPanel.firstChild);
                }
                
                // إزالة التنبيه تلقائياً بعد 10 ثوانٍ
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.remove();
                    }
                }, 10000);
            }
        }

        // ==============================================
        // اللوحة الرئيسية للإدارة
        // ==============================================
        
        class AdminPanel {
            constructor() {
                this.authManager = new AdminAuthManager();
                this.dataManager = new DataManager();
                this.sections = [];
                this.channels = [];
                this.filteredChannels = [];
                this.init();
            }

            async init() {
                console.log('Admin panel initializing...');
                
                // انتظار تهيئة نظام المصادقة
                setTimeout(() => {
                    if (this.authManager.isAuthenticated) {
                        this.setupEventListeners();
                        this.loadInitialData();
                    }
                }, 1000);
            }

            async loadInitialData() {
                console.log('Loading initial data...');
                
                // تحميل الأقسام
                this.sections = await this.dataManager.loadSections();
                this.renderSectionsList();
                this.populateSectionDropdowns();
                
                // تحميل القنوات
                this.channels = await this.dataManager.loadChannels();
                this.filterChannels();
                
                this.updateStats();
            }

            async reloadData() {
                console.log('Reloading data...');
                await this.loadInitialData();
            }

            // باقي الدوال تبقى كما هي مع استبدال استدعاءات Firebase باستدعاءات DataManager
            // [يتبع نفس المنطق السابق مع تعديل الاستدعاءات]
            
            setupEventListeners() {
                // Section form submission
                const sectionForm = document.getElementById('sectionForm');
                if (sectionForm) {
                    sectionForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        const section = {
                            name: document.getElementById('sectionName').value,
                            order: document.getElementById('sectionOrder').value,
                            isActive: document.getElementById('sectionStatus').value,
                            description: document.getElementById('sectionDescription').value
                        };
                        
                        await this.addSection(section);
                    });
                }

                // Channel form submission
                const channelForm = document.getElementById('channelForm');
                if (channelForm) {
                    channelForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        
                        const channel = {
                            name: document.getElementById('channelName').value,
                            image: document.getElementById('channelImage').value,
                            url: document.getElementById('channelUrl').value,
                            appUrl: document.getElementById('channelApp').value,
                            downloadUrl: document.getElementById('channelDownload').value,
                            order: document.getElementById('channelOrder').value,
                            sectionId: document.getElementById('channelSection').value
                        };
                        
                        await this.addChannel(channel);
                    });
                }

                // Logout button
                const logoutButton = document.getElementById('logoutAdmin');
                if (logoutButton) {
                    logoutButton.addEventListener('click', async () => {
                        const result = await this.authManager.logout();
                        if (result.success) {
                            window.location.href = 'index.html';
                        }
                    });
                }

                console.log('Event listeners setup completed');
            }

            // دالات العرض والتحديث [تبقى كما هي]
            // ... (نفس كود العرض السابق)

        }

        // التهيئة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Admin page DOM loaded, initializing...');
            window.adminPanel = new AdminPanel();
        });

    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
