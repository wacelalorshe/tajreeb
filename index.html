<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wacel Live</title>

    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">

    <style>
        body {
            background: #0e0a23;
            color: white;
            font-family: "Tahoma";
            margin: 0;
            padding: 0;
        }

        /* أيقونة الإشعارات */
        #notifyIcon {
            position: fixed;
            top: 15px;
            left: 15px;
            font-size: 28px;
            cursor: pointer;
            z-index: 9999;
        }

        #notifyCount {
            position: absolute;
            top: -5px;
            right: -10px;
            background: red;
            padding: 2px 6px;
            border-radius: 50%;
            font-size: 12px;
            color: white;
        }

        /* صندوق الإشعارات */
        #notificationsBox {
            position: fixed;
            top: 60px;
            left: 10px;
            width: 300px;
            max-height: 450px;
            overflow-y: auto;
            background: #1b1733;
            border: 2px solid #654FD4;
            border-radius: 12px;
            padding: 10px;
            display: none;
            z-index: 9999;
        }

        .notify-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .notify-item img {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 8px;
        }

        /* popup */
        .popup {
            position: fixed;
            bottom: 25px;
            right: 20px;
            width: 270px;
            background: #221c41;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #654FD4;
            color: white;
            z-index: 99999;
            animation: pop 0.3s;
        }

        @keyframes pop {
            from { transform: translateY(30px); opacity: 0; }
            to   { transform: translateY(0); opacity: 1; }
        }

    </style>
</head>
<body>

    <!-- أيقونة الإشعار -->
    <div id="notifyIcon">
        <i class="uil uil-bell"></i>
        <span id="notifyCount">0</span>
    </div>

    <!-- صندوق الإشعارات -->
    <div id="notificationsBox"></div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // ------------ Firebase Configuration -------------
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "0000000000",
            appId: "APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ----------- تحميل الإشعارات --------------
        async function loadNotifications() {
            try {
                const snapshot = await db.collection("notifications")
                    .orderBy("timestamp", "desc")
                    .limit(20)
                    .get();

                let list = snapshot.docs.map(doc => doc.data());

                // احتساب آخر 3 أيام
                const limit = 3 * 24 * 60 * 60 * 1000;
                list = list.filter(n => Date.now() - n.timestamp < limit);

                document.getElementById("notifyCount").textContent = list.length;

                const box = document.getElementById("notificationsBox");

                if (list.length === 0) {
                    box.innerHTML = "<p>لا توجد إشعارات</p>";
                    return;
                }

                box.innerHTML = list.map(n => `
                    <div class="notify-item">
                        ${n.image ? `<img src="${n.image}">` : ''}
                        <h4>${n.title}</h4>
                        <p>${n.message}</p>
                        ${n.link ? `<a href="${n.link}" target="_blank" style="color:#a4d5ff">فتح الرابط</a>` : ""}
                        <small>${new Date(n.timestamp).toLocaleString()}</small>
                    </div>
                `).join("");

                // popup لأول إشعار
                showPopup(list[0]);

            } catch (err) {
                console.error("خطأ جلب الإشعارات:", err);
            }
        }

        // -------- popup -----------
        function showPopup(n) {
            const div = document.createElement("div");
            div.className = "popup";

            div.innerHTML = `
                ${n.image ? `<img src="${n.image}" style="width:100%;border-radius:10px;">` : ""}
                <h4>${n.title}</h4>
                <p>${n.message}</p>
                ${n.link ? `<a href="${n.link}" target="_blank" style="color:#9dd1ff">فتح الرابط</a>` : ""}
            `;

            document.body.appendChild(div);

            setTimeout(() => div.remove(), 7000);
        }

        // -------- فتح واغلاق قائمة الإشعارات -----------
        document.getElementById("notifyIcon").onclick = () => {
            const box = document.getElementById("notificationsBox");
            box.style.display = box.style.display === "block" ? "none" : "block";
        };

        // تحميل عند فتح الموقع
        loadNotifications();
    </script>
</body>
</html>
